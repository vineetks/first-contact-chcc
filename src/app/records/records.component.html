<div class="records-container">
  <div class="welcome-back">
    <h2>Welcome Back, Doctor!</h2>
    <p>Manage your newborn patient records</p>
  </div>

  <div class="stats-grid">
    <div class="stat-card">
      <h3>Total Records</h3>
      <p class="stat-number">{{ records.length }}</p>
    </div>
    <div class="stat-card">
      <h3>This Month</h3>
      <p class="stat-number">{{ getThisMonthCount() }}</p>
    </div>
    <div class="stat-card">
      <h3>This Week</h3>
      <p class="stat-number">{{ getThisWeekCount() }}</p>
    </div>
  </div>

  <div class="header-section">
    <h3>All Records</h3>
    <button class="btn-add" (click)="openPopup()">+ Add New Record</button>
  </div>

  @if (successMessage) {
    <div class="success-message">
      <span>âœ“ {{ successMessage }}</span>
    </div>
  }

  <div class="records-list">
    @if (isLoading) {
      <div class="loading-container">
        <div class="spinner"></div>
        <p>Loading child records...</p>
      </div>
    } @else if (errorMessage) {
      <div class="error-container">
        <p class="error-message">{{ errorMessage }}</p>
        <button class="btn-retry" (click)="retryLoading()">Retry</button>
      </div>
    } @else if (records.length === 0) {
      <p class="no-records">No records found. Click "Add New Record" to create your first entry.</p>
    } @else {
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>Baby Name</th>
              <th>DOB</th>
              <th>Gender</th>
              <th>Mother's Name</th>
              <th>Father's Name</th>
              <th>Contact</th>
              <th>Email</th>
              <th>Address</th>
              <th>PIN</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            @for (record of records; track record.id) {
              <tr>
                <td>{{ record.babyName }}</td>
                <td>{{ record.dob }}</td>
                <td>{{ record.gender }}</td>
                <td>{{ record.motherName }}</td>
                <td>{{ record.fatherName }}</td>
                <td>{{ record.contactNo }}</td>
                <td>{{ record.email || '-' }}</td>
                <td>{{ record.address }}</td>
                <td>{{ record.pin }}</td>
                <td>
                  <button class="btn-delete" (click)="deleteRecord(record.id)">Delete</button>
                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>
    }
  </div>
</div>

<!-- Popup Modal -->
@if (showPopup) {
  <div class="modal-overlay" (click)="closePopup()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Add New Record</h3>
        <button class="close-btn" (click)="closePopup()">&times;</button>
      </div>

      <form (ngSubmit)="onSubmit()" #recordForm="ngForm">
        <div class="form-grid">
          <div class="form-group">
            <label for="babyName">Baby Name *</label>
            <input type="text" id="babyName" name="babyName" [(ngModel)]="newRecord.babyName" required>
          </div>

          <div class="form-group">
            <label for="dob">Date of Birth *</label>
            <input type="date" id="dob" name="dob" [(ngModel)]="newRecord.dob" required>
          </div>

          <div class="form-group">
            <label>Gender *</label>
            <div class="radio-group">
              <label class="radio-label">
                <input type="radio" name="gender" value="Male" [(ngModel)]="newRecord.gender" required>
                <span>Male</span>
              </label>
              <label class="radio-label">
                <input type="radio" name="gender" value="Female" [(ngModel)]="newRecord.gender" required>
                <span>Female</span>
              </label>
            </div>
          </div>

          <div class="form-group">
            <label for="motherName">Mother's Name *</label>
            <input type="text" id="motherName" name="motherName" [(ngModel)]="newRecord.motherName" required>
          </div>

          <div class="form-group">
            <label for="fatherName">Father's Name *</label>
            <input type="text" id="fatherName" name="fatherName" [(ngModel)]="newRecord.fatherName" required>
          </div>

          <div class="form-group">
            <label for="contactNo">Contact Number *</label>
            <input type="tel" id="contactNo" name="contactNo" [(ngModel)]="newRecord.contactNo"
                   #contactNo="ngModel" required pattern="[0-9]{10}" maxlength="10"
                   (blur)="onFieldBlur(contactNo)">
            @if (contactNo.invalid && (contactNo.dirty || contactNo.touched)) {
              <span class="error-text">Contact number must be exactly 10 digits</span>
            }
          </div>

          <div class="form-group full-width">
            <label for="address">Address *</label>
            <input type="text" id="address" name="address" [(ngModel)]="newRecord.address" required>
          </div>

          <div class="form-group">
            <label for="pin">PIN Code *</label>
            <input type="text" id="pin" name="pin" [(ngModel)]="newRecord.pin"
                   #pin="ngModel" required pattern="[0-9]{6}" maxlength="6"
                   (blur)="onFieldBlur(pin)">
            @if (pin.invalid && (pin.dirty || pin.touched)) {
              <span class="error-text">PIN code must be exactly 6 digits</span>
            }
          </div>

          <div class="form-group">
            <label for="email">Email</label>
            <input type="email" id="email" name="email" [(ngModel)]="newRecord.email"
                   #email="ngModel" pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$"
                   (blur)="onFieldBlur(email)">
            @if (email.invalid && (email.dirty || email.touched)) {
              <span class="error-text">Please enter a valid email address</span>
            }
          </div>
        </div>

        <div class="form-actions">
          <button type="submit" class="btn-primary" [disabled]="!recordForm.form.valid">Add Record</button>
          <button type="button" class="btn-secondary" (click)="closePopup()">Cancel</button>
        </div>
      </form>
    </div>
  </div>
}
