@if (isOpen) {
  <div class="modal-overlay" (click)="close()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>{{ isEditMode ? 'Edit Record' : 'Add New Record' }}</h3>
        <button class="close-btn" (click)="close()">&times;</button>
      </div>

      <!-- Tab Navigation -->
      <div class="tab-navigation">
        <button type="button" class="tab-btn" [class.active]="currentTab === 'child'" (click)="currentTab = 'child'">
          Basic Information
        </button>
        <button type="button" class="tab-btn" [class.active]="currentTab === 'parent'" [disabled]="!isFirstTabSaved" (click)="isFirstTabSaved && (currentTab = 'parent')">
          Address & Details
        </button>
      </div>

      <form (ngSubmit)="onSubmit()" #recordForm="ngForm">
        <!-- Tab 1: Basic Information -->
        @if (currentTab === 'child') {
          <div class="form-grid tab-content">
            <div class="form-group">
              <label for="babyName">Baby Name *</label>
              <input type="text" id="babyName" name="babyName" [(ngModel)]="record.babyName"
                     #babyName="ngModel" required
                     (blur)="onFieldBlur(babyName)">
              @if (showFirstTabErrors && !record.babyName) {
                <span class="error-text">Baby name is required</span>
              }
            </div>

            <div class="form-group">
              <label>Gender *</label>
              <div class="radio-group">
                <label class="radio-label">
                  <input type="radio" name="gender" value="Male" [(ngModel)]="record.gender">
                  <span>Male</span>
                </label>
                <label class="radio-label">
                  <input type="radio" name="gender" value="Female" [(ngModel)]="record.gender">
                  <span>Female</span>
                </label>
              </div>
              @if (showFirstTabErrors && !record.gender) {
                <span class="error-text">Gender is required</span>
              }
            </div>

            <div class="form-group">
              <label for="motherName">Mother's Name *</label>
              <input type="text" id="motherName" name="motherName" [(ngModel)]="record.motherName"
                     #motherName="ngModel" required
                     (blur)="onFieldBlur(motherName)">
              @if (showFirstTabErrors && !record.motherName) {
                <span class="error-text">Mother's name is required</span>
              }
            </div>

            <div class="form-group">
              <label for="fatherName">Father's Name *</label>
              <input type="text" id="fatherName" name="fatherName" [(ngModel)]="record.fatherName"
                     #fatherName="ngModel" required
                     (blur)="onFieldBlur(fatherName)">
              @if (showFirstTabErrors && !record.fatherName) {
                <span class="error-text">Father's name is required</span>
              }
            </div>

            <div class="form-group">
              <label for="dob">Date of Birth *</label>
              <input type="date" id="dob" name="dob" [(ngModel)]="record.dob"
                     #dob="ngModel" required
                     (blur)="onFieldBlur(dob)">
              @if (showFirstTabErrors && !record.dob) {
                <span class="error-text">Date of birth is required</span>
              }
            </div>

            <div class="form-group">
              <label for="contactNo">Contact Number *</label>
              <input type="tel" id="contactNo" name="contactNo" [(ngModel)]="record.contactNo"
                     #contactNo="ngModel" pattern="[0-9]{10}" maxlength="10" required
                     (blur)="onFieldBlur(contactNo)">
              @if (showFirstTabErrors && !record.contactNo) {
                <span class="error-text">Contact number is required</span>
              } @else if (contactNo.invalid && (contactNo.dirty || contactNo.touched)) {
                <span class="error-text">Contact number must be exactly 10 digits</span>
              }
            </div>
          </div>

          <div class="form-actions">
            <button type="button" class="btn-save" (click)="saveFirstTab()">Save</button>
          </div>
        }

        <!-- Tab 2: Address & Other Details -->
        @if (currentTab === 'parent') {
          <div class="form-grid tab-content">
            <div class="form-group">
              <label for="state">State</label>
              <select id="state" name="state" [(ngModel)]="record.state" (change)="onStateChange($any($event.target).value)">
                <option value="">Select State</option>
                @for (state of states; track state) {
                  <option [value]="state">{{ state }}</option>
                }
              </select>
            </div>

            <div class="form-group">
              <label for="district">District</label>
              <select id="district" name="district" [(ngModel)]="record.district" [disabled]="!record.state">
                <option value="">Select District</option>
                @for (district of filteredDistricts; track district) {
                  <option [value]="district">{{ district }}</option>
                }
              </select>
            </div>

            <div class="form-group full-width">
              <label for="address">Address</label>
              <input type="text" id="address" name="address" [(ngModel)]="record.address">
            </div>

            <div class="form-group">
              <label for="email">Email</label>
              <input type="email" id="email" name="email" [(ngModel)]="record.email"
                     #email="ngModel" pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$"
                     (blur)="onFieldBlur(email)">
              @if (email.invalid && (email.dirty || email.touched)) {
                <span class="error-text">Please enter a valid email address</span>
              }
            </div>

            <div class="form-group">
              <label for="pin">PIN Code</label>
              <input type="text" id="pin" name="pin" [(ngModel)]="record.pin"
                     #pin="ngModel" pattern="[0-9]{6}" maxlength="6"
                     (blur)="onFieldBlur(pin)">
              @if (pin.invalid && (pin.dirty || pin.touched)) {
                <span class="error-text">PIN code must be exactly 6 digits</span>
              }
            </div>
          </div>

          <div class="form-actions">
            <button type="button" class="btn-save" (click)="saveSecondTab()">Save</button>
          </div>
        }
      </form>
    </div>
  </div>
}
